<!DOCTYPE html>
<html>
<title>Deep Lyrics</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins">
<link rel="stylesheet" href="styles.css">
<script type="text/javascript" src="bundle.js" ></script>
<script type="text/javascript" src="node_modules/fetch/lib/fetch.js" ></script>
<style>
body,h1,h2,h3,h4,h5 {font-family: "Poppins", sans-serif}
body {font-size:16px;}
.w3-half img{margin-bottom:-6px;margin-top:16px;opacity:0.8;cursor:pointer}
.w3-half img:hover{opacity:1}
</style>
<body>

<!-- Sidebar/menu -->
<nav class="w3-sidebar w3-red w3-collapse w3-top w3-large w3-padding" style="z-index:3;width:300px;font-weight:bold;" id="mySidebar"><br>
  <a href="javascript:void(0)" onclick="w3_close()" class="w3-button w3-hide-large w3-display-topleft" style="width:100%;font-size:22px">Close Menu</a>
  <div class="w3-container">
    <h3 class="w3-padding-64"><b>Deep<br>Lyrics</b></h3>
  </div>
  <div class="w3-bar-block">
    <a href="#" onclick="w3_close()" class="w3-bar-item w3-button w3-hover-white">Home</a>
    <a href="#try" onclick="w3_close()" class="w3-bar-item w3-button w3-hover-white">Try it out!</a>
    <a href="#works" onclick="w3_close()" class="w3-bar-item w3-button w3-hover-white">How it works</a>
    <a href="#team" onclick="w3_close()" class="w3-bar-item w3-button w3-hover-white">Meet the team</a>
  </div>
</nav>

<!-- Top menu on small screens -->
<header class="w3-container w3-top w3-hide-large w3-red w3-xlarge w3-padding">
  <a href="javascript:void(0)" class="w3-button w3-red w3-margin-right" onclick="w3_open()">☰</a>
  <span>Deep Lyrics</span>
</header>

<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

<!-- !PAGE CONTENT! -->
<div class="w3-main" style="margin-left:340px;margin-right:40px">

  <!-- Header -->
  <div class="w3-container" style="margin-top:80px" id="showcase">
    <h1 class="w3-jumbo"><b>Deep Lyrics</b></h1>
    <h1 class="w3-xxxlarge w3-text-red"><b>Deep learning based lyrics generator</b></h1>
  </div>

  <!-- Home -->
  <div class="w3-container" id="home" >
    <!-- <h1 class="w3-xxxlarge w3-text-red"><b>Services.</b></h1> -->
    <hr style="width:50px;border:5px solid red" class="w3-round">
    <p>We are a group of UC Berkeley graduate students dissecting what it means for a machine to be creative using deep learning to generate song lyrics.</p>
    <p>Composing a creative and novel song consists of two main components. First, DeepLyrics learns the rules of language by observing previous bodies of work. We call these rules
      the model. Besides some initial encoding rules, we allow Deep Learning techniques to implicitly learn language rules on its own such as part-of-speech, grammar, rhyme, and song
      structure. Furthermore, song lyrics allow for the exploitation of other modes of data  — such as those related to the music itself.</p>

    <p>The generator is the second component. This is where we achieve the emulation of creativity. While staying within the confines of the model, we add randomness, noise, and
      blending of existing attributes to generate creative and novel lyrics.</p>
        
    <p></p>For further analysis, we've simulated tens of thousands of examples generated by DeepLyrics to score against both existing bodies of creative and non-creative work.
    We capture both metrics that "measure" creativeness and ones that measure rule conformity.
    </p>
  </div>

  <!-- Try -->
  <div class="w3-container" id="try" style="margin-top:75px">
    <h1 class="w3-xxxlarge w3-text-red"><b>Try it out!</b></h1>
    <hr style="width:50px;border:5px solid red" class="w3-round">
    <p>Do you want to try our lyrics generator? Login to Spotify to choose a song and we'll generate lyrics from it, or generate a custom lyric by giving us information such as genre, title and technical details.</p>

    <h2 class="w3-xlarge w3-text-red"><b>Spotify Song Lyric Generation</b></h2>
    Search for songs in Spotify, and we'll generate a lyric for it using the audio information. If you are an advanced user and want to further customize your lyrics technical parameters, we'll show you the advanced lyric parameters and you can edit them to make your perfect lyric!
    <!-- <form action="javascript:()"> -->
      <div class="w3-section">
        <label>Song or artist search terms</label>
        <input class="w3-input w3-border" type="text" id="search_term" />
      </div>
      <!-- <div class="w3-section">
        <label>Tags</label>
        <input class="w3-input w3-border" type="text" name="Tags" >
      </div> -->
    <button type="button" onclick="javascript:searchSongs()" class="w3-button w3-block w3-padding-large w3-red w3-margin-bottom">Search</button>
    <button type="button" onclick="javascript:document.getElementById('song_search_results').innerHTML = '';" class="w3-button w3-block w3-padding-large w3-red w3-margin-bottom">Clear</button>
        <!-- </form> -->

    <!-- Song display -->

    <div id="song_search_results" class="w3-row-padding w3-grayscale">
    </div>
    
    <h2 class="w3-xlarge w3-text-red"><b>Customized Lyric Generation</b></h2>
    If you don't have any song in particular you want a lyric for, we can just create a lyric based on general parameters such as danceability, mode or genre. We'll provide you with some options to get you started and you can modify and customize them!
    <button type="button" onclick="javascript:customized()" class="w3-button w3-block w3-padding-large w3-red w3-margin-bottom">Customize</button>
  </div>
  
      <!-- Lyric result tabbed modal -->
      <div id="id01" class="w3-modal">
        <div class="w3-modal-content w3-card-4 w3-animate-zoom">
         <header class="w3-container w3-red">
          <span onclick="document.getElementById('id01').style.display='none'"
          class="w3-button w3-red w3-xlarge w3-display-topright">&times;</span>
          <h2>Deep Lyrics</h2>
         </header>
       
         <div class="w3-bar w3-border-bottom">
          <button class="tablink w3-bar-item w3-button" onclick="openSection(event, 'generated_lyrics')">Lyrics</button>
          <button class="tablink w3-bar-item w3-button" onclick="openSection(event, 'lyrics_details')">Details</button>
          <button class="tablink w3-bar-item w3-button" onclick="openSection(event, 'lyrics_parameters')">Parameters</button>
         </div>
       
         <div id="generated_lyrics" class="w3-container city">
          <h1>Lyrics</h1>
          <div id="lyrics_div" class="m4 w3-margin-bottom"  >
            <div class="w3-light-grey">
              <div class="w3-container">
                <p id="lyrics_p" contenteditable="true"></p>
              </div>
            </div>
          </div>
         </div>
       
         <div id="lyrics_details" class="w3-container city">
          <h1>Details</h1>
          <pre id="lyrics_details_p">Technical details from the lyrics response like scores.</pre>
         </div>

         <div id="lyrics_parameters" class="w3-container city">
          <h1>Parameters</h1>
          <pre id="lyrics_parameters_p">Original lyrics parameters, such as loudness, danceability, etc.</pre>
         </div>
       
         <div class="w3-container w3-light-grey w3-padding">
          <button class="w3-button w3-right w3-white w3-border"
          onclick="document.getElementById('id01').style.display='none'">Close</button>
         </div>
        </div>
       </div>

       <div id="id03" class="w3-modal">
        <div class="w3-modal-content w3-card-4 w3-animate-zoom">
          <div id="loader"></div>
        </div>
       </div>
       
      <!-- Lyric configuration modal -->
      <div id="id02" class="w3-modal">
        <div class="w3-modal-content w3-card-4 w3-animate-zoom">
         <header class="w3-container w3-red">
          <span onclick="document.getElementById('id02').style.display='none'"
          class="w3-button w3-red w3-xlarge w3-display-topright">&times;</span>
          <h2>Deep Lyrics Settings</h2>
          Click on the 'Generate' button to get your lyrics.
          If you want to customize how we generate those lyrics, edit the parameters below.
          Generating new lyrics for a summertime feel, but want it with an oldies twist? Simply add an 'oldies' genre!
         </header>
         <button class="tablink2 w3-bar-item w3-button" onclick="openSection(event, 'generated_lyrics2')">Lyrics settings</button>
         <div id="generated_lyrics2" class="w3-container city2">
          <h1>Lyrics Configuration</h1>
          <div id="lyrics_div2" class="m4 w3-margin-bottom"  >
            <div class="w3-light-grey">
              <div class="w3-container">
                <p id="lyrics_p2" contenteditable="true"></p>
              </div>
            </div>
          </div>
         </div>
       
         <button type="button" id="modal_generate" class="w3-button w3-block w3-padding-large w3-red w3-margin-bottom">Generate</button>

         <div class="w3-container w3-light-grey w3-padding">
          <button class="w3-button w3-right w3-white w3-border"
          onclick="document.getElementById('id02').style.display='none'">Close</button>
         </div>
        </div>
       </div>

    <!-- How it works -->
  <div class="w3-container" id="works" style="margin-top:75px">
    <h1 class="w3-xxxlarge w3-text-red"><b>How it works</b></h1>
    <hr style="width:50px;border:5px solid red" class="w3-round">
    <p>An explanation of some of the more technical details.</p>
    <h2 class="w3-xlarge w3-text-red"><b>Language Models, Transfer Learning & Deep Representations</b></h2>
    <p>At its core, our language model has one task: predict the most likely next word. Although this is a simple task, language models have become incredibly powerful and are being used everywhere from smartphone autocomplete to classifying the sentiment of news articles.
    At a high-level, neural language models and word embeddings like Word2Vec and GloVe learn a continuous representation of words in latent space solely in the process of trying to predict words in order. These language models already use a basic form of transfer learning and the resulting word-vector representations capture powerful, high-level information about words and sentences
    like semantics and sytax.
    </p>
      <div class="w3-row-padding">
        <center>
          <figure>
              <img src="images/wordrelations.png" style="width:700px" alt="Word Relations with Word2Vec">
              <figcaption>"Simple" neural language models and their word-embeddings are able to learn word relations and semantic meaning. Source: https://thegradient.pub/nlp-imagenet/ and TensorFlow tutorial</figcaption>
          </figure>
        </center>
      </div>
      <p>More recently, language representation models (Deep Representations) like ULMFiT (Howard and Ruder, 2018), Open AI's Transformer (Radford et al., 2018) and Google's BERT (Devlin et al., 2018) have all been able to further leverage transfer learning and build upon
        the success of extracted, static word-embeddings in order to improve model perplexities and performance on downstream target tasks. Rather than extracting a single vector of word embeddings, these newer models "obtain the vectors of each of the internal functional states of every layer, and combine them in a weighted fashion to get the final embeddings" (<a href="https://medium.com/explorations-in-language-and-learning/transfer-learning-in-nlp-2d09c3dfaeb6">Desh Raj</a>). These approaches will soon be ubiquitous in NLP tasks.</p>
      <p>Our lyrics generation model is built upon ULMFiT which uses a 3-layer AWD-LSTM (Merity et. al, 2017), pretrained on a large corpus of Wikipedia entries. Following this pre-training, we unfreeze the model's parameters and continue to train on a corpus of ~500k songs.
        Through this process, we maintain the model's learned representations of syntax, semantics, and context, while also learning poetry and song specific information like meter, rhyme, and anaphora. In this step, we also include special tokens for genre and song title in order to conditionally
        learn different distributions based on those attributes.
      </p>
      <div class="w3-row-padding">
          <center>
            <figure>
                <img src="images/ulmfit.png" style="width:700px" alt="ULMFiT Training Process">
                <figcaption>Language representation models utilize pre-training and transfer learning for improved performance. In figure a, a 3-layer LSTM is trained on a large corpus of text (Wikitext-103). In
                 figure b, that same language model is fine-tuned on our corpus of lyrics. Source: Universal Language Model Fine-tuning for Text Classification (Howard and Ruder, 2018)
                </figcaption>
            </figure>
          </center>
        </div>
    <h2 class="w3-xlarge w3-text-red"><b>Multimodality</b></h2>
    <p>As its name suggests, multimodality is the process of learning from multiple modes (a.k.a. pieces of different information). These pieces of information have different statistical distributions and all can contribute to a model's understanding of how best to solve for its
      end task. Most research into the realm of multimodal learning has been in computer vision, where the goal of video to text or text to image neccesitates the ability to manipulate both raw pixel info and pure language. In our case, to
      generate lyrics, we are able to combine pure language with numerical attributes of music like tone, time signature, tempo, and more.</p>
    <p>In order to do that, we begin with the fine-tuned language model from above and experiment with various architectures that inject information about a song's musical content. In addition to genre and song-title tokens, this information further contributes to the model's understanding
      of distributions conditional on multiple modes.
    </p>
      <center>
          <figure>
              <img src="images/multimodal.png" style="width:700px" alt="Multimodal Architecture">
              <figcaption>A representation of the first step in one of our multimodal language model architectures.
              </figcaption>
          </figure>
        </center>
      </div>
    
    <h2 class="w3-xlarge w3-text-red"><b>Generation & Beam Search</b></h2>
    <p>If the language models we saw above learn the rules, then the generator breaks them. So far, we've only talked about the output of a model being to predict the next word or lyric, but we haven't
      said anything about generating an entire song.</p>
    <p>More specifically, in order to generate novel and potentially creative lyrics, we can't take a "greedy" approach and simply pick the next word with the highest probability. "Greedy" decoding may result in high conformity to part-of-speech rules and sentences that generally make sense, but the songs would be boring
      and likely become stuck in local minima, repeating the same lines over again. Instead, we start with two important tweaks to the decoding process, utilizing a temperature hyperparameter (scaling logits prior to the model's softmax in order to relatively increase the probabilities of "less sure words") and drawing next-word samples from a multinomial distribution rather than taking a specified top-k number of words.
    </p>
    <p>Perhaps most crucially, we use an algorithm called beam search and apply several modifications to that, too. Beam search takes a breadth-first approach to generating possible next word options for each generated song. Through the search for next words, the algorithm keeps track of paths and their joint probabilities/scores. During each successive step, we throw away all but N number
      of possible songs (where N is also a tunable hyperparameter). With enough succesive iterations, our model and generator is able to draw the fine line between nonsense and beauty.
    </p>
      <center>
          <figure>
              <img src="images/searchtree.png" style="width:700px" alt="Beam Search Vizualization">
              <figcaption>A glimpse into the search tree from a random sample of our model and generator. Each node represents a possible next word. The path of blue nodes represents the "winning" song.</figcaption>
          </figure>
      </center>
        
  <!-- The team -->
  <div class="w3-container" id="team" style="margin-top:75px">
    <h1 class="w3-xxxlarge w3-text-red"><b>Meet the team</b></h1>
    <hr style="width:50px;border:5px solid red" class="w3-round">
    <p>We are a team of UC Berkeley MIDS students. DeepLyrics represents the culmination of our efforts through our Capstone course.
    </p>
  </div>

  <!-- The Team -->
  <div class="w3-row-padding w3-grayscale">
    <div class="w3-col m3 w3-margin-bottom">
      <div class="w3-light-grey">
        <img src="images/steve.jpg" alt="Steve Yang" style="width:100%">
        <div class="w3-container">
          <h3>Steve Yang</h3>
          <p>Based out of Los Angeles, Steve is a Data Scientist at Uber. As a graduate student at UC Berkeley, he found a deep interest for NLP, Causal Experimentation, and other Machine Learning in Latent Space. Additionally, as a guitarist and electronic music producer, Steve is fascinated by research topics that blend together science and art. </p>
        </div>
      </div>
    </div>
    <div class="w3-col m3 w3-margin-bottom">
      <div class="w3-light-grey">
        <img src="images/jason.jpg" alt="Jason Rosenfeld" style="width:100%">
        <div class="w3-container">
          <h3>Jason Rosenfeld</h3>
          <p>Jason lives in New York City and works as a Data Scientist at Millennium Management. He has become interested in the field of Natural Language Processing (Understanding) through the curious combination
              of his other passions: life-long learning, behavioral economics, decentralization, and probability. He can explain.
          </p>
        </div>
      </div>
    </div>
    <div class="w3-col m3 w3-margin-bottom">
      <div class="w3-light-grey">
          <img src="images/justin.jpg" alt="Justin Plumley" style="width:100%">
          <div class="w3-container">
          <h3>Justin Plumley</h3>
          <p>Justin works in dedication to improving healthcare through data science. Enjoying a life-long love of math and storytelling, he has a strong interest with something that sits between the two--language. He resides in North Carolina with his wife and children, who continue to create all of his favorite stories.</p>
        </div>
      </div>
    </div>
    <div class="w3-col m3 w3-margin-bottom">
      <div class="w3-light-grey">
        <img src="images/carlos.jpg" alt="Carlos Castro" style="width:100%">
        <div class="w3-container">
          <h3>Carlos Castro</h3>
          <p> Carlos is a computer scientist at Microsoft Research, focused on infusing natural language into apps and devices to make for more powerful and accessible experiences. Carlos has a profound passion for problem solving. He consistently contributes to world class challenges in diverse domains such as bioinformatics, large scale distributed systems, real-time communications and more recently natural language.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- End page content -->
</div>

<!-- W3.CSS Container -->
<div class="w3-light-grey w3-container w3-padding-32" style="margin-top:75px;padding-right:58px"><p class="w3-right">Powered by <a href="https://www.w3schools.com/w3css/default.asp" title="W3.CSS" target="_blank" class="w3-hover-opacity">w3.css</a></p></div>

<script>

document.getElementsByClassName("tablink")[0].click();

function openSection(evt, sectionName) {
  var i, x, tablinks;
  x = document.getElementsByClassName("city");
  for (i = 0; i < x.length; i++) {
    x[i].style.display = "none";
  }
  tablinks = document.getElementsByClassName("tablink");
  for (i = 0; i < x.length; i++) {
    tablinks[i].classList.remove("w3-light-grey");
  }
  document.getElementById(sectionName).style.display = "block";
  evt.currentTarget.classList.add("w3-light-grey");
}

document.getElementsByClassName("tablink2")[0].click();

function customized() {
  
  const example = JSON.stringify({
                  title: "Sugar",
                  genres: ['alternative rock'],
                  max_len: 100,
                  beam_width: 3,
                  temperature: 1.45,
                  top_k: 10,
                  context_length: 70,
                  model_type: "language",
                  mode: 1,
                  energy: 0.87,
                  key: 11,
                  loudness: -4.812,
                  duration: 362821,
                  tempo: 171.99,
                  time_signature: 4
              });

  document.getElementById('modal_generate').onclick = function() {generateLyricsForSong(null, null, null, false, true);};
  document.getElementById('lyrics_p2').innerText = example;
  document.getElementById('id02').style.display='block';
  
}

/*
* Spotify API
*/

function getAccessTokenFromUrl() {
    var hashParams = {};
    var e, r = /([^&;=]+)=?([^&;]*)/g,
        q = window.location.hash.substring(1);
    while ( e = r.exec(q)) {
        hashParams[e[1]] = decodeURIComponent(e[2]);
    }
    return hashParams.access_token;
  }

function searchSongs() {

    const term = document.getElementById("search_term").value;
    const accessToken = getAccessTokenFromUrl();

    if(!accessToken) {
        window.location.replace('https://accounts.spotify.com/authorize?client_id=d74ff6993a754cf8a6d439ec00ce6e66&redirect_uri=http://deeplyrics.net/&response_type=token&state=123');
    } else {
        fetch(`https://api.spotify.com/v1/search?q=${term}&type=track&limit=20`, {
            method: 'GET',
            headers: new Headers({
              'Authorization': 'Bearer ' + accessToken
            })
        }).then(response => {
            return response.json();
        }).then(json => {
            
            const tracks = json.tracks.items;

            document.getElementById("song_search_results").innerHTML = "";
            let html = "";

            for (let i in tracks) {
              const track = tracks[i];

              html += "<div class=\"w3-col m4 w3-margin-bottom\">";
              html += "<div class=\"w3-light-grey\">"
              html += "<div class=\"w3-container\">";
              html += `<h3>${track.artists[0].name}: ${track.name}</h3>`;
              html += `<img src="${track.album.images[0].url}"  style="width:100%"/>`;
              html +=  `<button type="button" id="${track.id}" onclick="javascript:generateLyricsForSong('${track.id}', '${track.name}', '${track.artists[0].id}', false)" class="w3-button w3-block w3-padding-large w3-red w3-margin-bottom">Generate lyrics</button>`;
              html += `<button type="button" onClick="window.open('${track.external_urls['spotify']}');" class="w3-button w3-block w3-padding-large w3-red w3-margin-bottom">Listen in Spotify</button>`;
              html += `</div></div></div>`
            }
            document.getElementById("song_search_results").innerHTML = html;
        }).catch(err => {
            log(err);
            alert("Error:" + err);
        });
    }
}

/*
* Lyrics generation
*/

function generateRandomLyrics() {
  alert("generateRandomLyrics not implemented yet!");
}

function generateLyricsForSong(trackId, title, artistId, callServer, isCustom) {
  const accessToken = getAccessTokenFromUrl();
  if(!accessToken && !isCustom) {
        window.location.replace('https://accounts.spotify.com/authorize?client_id=d74ff6993a754cf8a6d439ec00ce6e66&redirect_uri=http://deeplyrics.net/&response_type=token&state=123');
    } else {

        if (!isCustom) {

          // Get audio features for song
          fetch(`https://api.spotify.com/v1/audio-features?ids=${trackId}`, {
              method: 'GET',
              headers: new Headers({
                'Authorization': 'Bearer ' + accessToken
              })
          }).then(response => {
              return response.json();
          }).then(json => {

            // Get artist information for genres
            fetch(`https://api.spotify.com/v1/artists/${artistId}`, {
              method: 'GET',
              headers: new Headers({
                'Authorization': 'Bearer ' + accessToken
              })
            }).then(artistResponse => {
                return artistResponse.json();
            }).then(artistJson => {

              const features = json.audio_features[0];

              let lyricsRequestBody = JSON.stringify({
                    mode: features.mode,
                    energy: features.energy,
                    key: features.key,
                    loudness: features.loudness,
                    duration: features.duration_ms,
                    tempo: features.tempo,
                    title: title,
                    genres: artistJson.genres,
                    time_signature: features.time_signature,
                    model_type: 'multimodal',
                    beam_width: 3,
                    top_k: 15,
                    context_length: 70,
                    max_len: 120
                });

              if (callServer) {

                lyricsRequestBody = document.getElementById('lyrics_p2').innerText;
                document.getElementById('id02').style.display='none';
                document.getElementById('id03').style.display='block';
                document.getElementById("loader").style.display = "block";
                

                // Call local server for lyric generation
                const url = 'http://34.228.251.186:8000'
                fetch(`${url}/lyrics`, {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json'
                  },
                  body: lyricsRequestBody
                }).then(function(response) {
                    return response.text();
                }).then(function(text) {

                    const responseJson = JSON.parse(JSON.parse(text));

                    showLyrics(responseJson.lyric);

                    document.getElementById('lyrics_details_p').innerHTML = JSON.stringify(responseJson.metrics, undefined, 2);

                    document.getElementById('id03').style.display='none';
                    document.getElementById("loader").style.display = "none";
                    
                    document.getElementById('id01').style.display='block';
                    document.getElementById('lyrics_parameters_p').innerHTML = JSON.stringify(JSON.parse(lyricsRequestBody), undefined, 2);
                    document.getElementsByClassName("tablink")[0].click();
                }).catch(function(ex) {
                  log(ex);
                  alert(`response failed ${ex}`);
                });
              } else {
                document.getElementById('lyrics_p2').innerText = lyricsRequestBody;
                document.getElementById('id02').style.display='block';
                document.getElementById('modal_generate').onclick = function() {generateLyricsForSong(trackId, title, artistId, true);};
              }
            });
          });
      } else {
        // custom lyrics
        let lyricsRequestBody = document.getElementById('lyrics_p2').innerText;
        document.getElementById('id02').style.display='none';
        document.getElementById('id03').style.display='block';
        document.getElementById("loader").style.display = "block";
        // Call local server for lyric generation
        const url = 'http://34.228.251.186:8000'
        fetch(`${url}/lyrics`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
          },
          body: lyricsRequestBody
        }).then(function(response) {
            return response.text();
        }).then(function(text) {
          const responseJson = JSON.parse(JSON.parse(text));
          showLyrics(responseJson.lyric);

          document.getElementById('lyrics_details_p').innerHTML = JSON.stringify(responseJson.metrics, undefined, 2);

          document.getElementById('id03').style.display='none';
          document.getElementById("loader").style.display = "none";

          document.getElementById('id01').style.display='block';
          document.getElementById('lyrics_parameters_p').innerHTML = JSON.stringify(JSON.parse(lyricsRequestBody), undefined, 2);
          document.getElementsByClassName("tablink")[0].click();
        }).catch(function(ex) {
          log(ex);
          alert(`response failed ${ex}`);
        });
      }
    }
}


// Handle lyric generation request
function generateLyrics() {

}

// Script to open and close sidebar
function w3_open() {
    document.getElementById("mySidebar").style.display = "block";
    document.getElementById("myOverlay").style.display = "block";
}

function w3_close() {
    document.getElementById("mySidebar").style.display = "none";
    document.getElementById("myOverlay").style.display = "none";
}

function showLyrics(lyrics) {
  //document.getElementById("lyrics_div").style.display = "block";
  var captionText = document.getElementById("lyrics_p");
  captionText.innerText = lyrics;
}

function hideLyrics() {
  document.getElementById("lyrics_div").style.display = "none";
}

</script>

</body>
</html>
